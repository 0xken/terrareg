{% extends 'module_details_common.html' %}

{% block module_breadcrumb %}
<li class="is-active"><a href="/modules/{{ namespace.name }}/{{ module.name }}/{{ module_provider.name }}">{{ module_provider.name }}</a></li>
{% endblock %}

{% block main_details %}
    <p class="title">
        {{ module.name }}
    </p>
    <p class="subtitle">
        Provider: {{ module_provider.name }}
    </p>

    {% if module_version %}

        {% if not module_version.published %}
        <p class="subtitle">
            <b>WARNING:</b> This version of the module is not published.
        </p>
        {% endif %}

        <p class="subtitle">
            {% if module_version.description %}{{ module_version.description }}{% else %}No description provided{% endif %}
        </p>
        <p>Published {{ module_version.publish_date_display }} by <a href="/modules/{{ namespace.name }}">{{ namespace.name }}</a></p>
        <p>{% if module_version.owner %}Module managed by {{ module_version.owner }}{% endif %}</p>
        <p>{% if module_version.get_source_browse_url() %}Source Code: <a href="{{ module_version.get_source_browse_url() }}">{{ module_version.get_source_browse_url() }}</a>{% endif %}</p>

        <br />

        {% if module_version.is_submodule %}
            <button>Back to parent</button>
        {% else %}
            {% if module_version.get_submodules() %}
            <div class="select is-small">
                <select onchange="selectSubmodule(event);">
                    <option value="none">Select submodule</option>
                    {% for submodule in module_version.get_submodules() %}
                    <option value="{{ submodule.get_view_url() }}">{{ submodule.path }}</option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}
        {% endif %}

    {% else %}
    <p>There are no published versions of this module.</p>
    {% endif %}

    <br />


    <script>
        function indexModuleVersion() {
            $.post(
                `/v1/terrareg/modules/{{ module_provider.id }}/${$('#indexModuleVersion').val()}/import`
            ).done(() => {
                $('#index-version-success').css('display', 'block');
                $('#index-version-error').css('display', 'none');
            }).fail((res) => {
                if (res.responseJSON && res.responseJSON.message) {
                    $('#index-version-error').html(res.responseJSON.message);
                } else {
                    $('#index-version-error').html('An unexpected error occurred');
                }
                $('#index-version-error').css('display', 'block');
            });
        }
    </script>
    <div id="index-version-success" style="display: none" class="notification is-success">
        Successfully indexed version
    </div>
    <div id="index-version-error" style="display: none" class="notification is-danger">
    </div>
    <div class="field has-addons">
        <div class="control">
            <input id="indexModuleVersion" class="input is-small" type="text" size="5" placeholder="1.0.0">
        </div>
        <div class="control">
            <a onclick="indexModuleVersion();" class="button is-info is-small">
            Index Version
            </a>
        </div>
    </div>

{% endblock %}